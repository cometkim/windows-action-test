name: Windows test

on:
  push:
    branches:
      - main

jobs:
  install-opam:
    runs-on: windows-2025
    steps:
      - name: Winget available?
        run: winget --help

      - name: Winget install OPAM
        run: |
          winget install --accept-source-agreements --accept-package-agreements Git.Git OCaml.opam
          $userPath = [System.Environment]::GetEnvironmentVariable("Path", "User")
          $userPath.Split(';') | ForEach-Object {
            if ($_ -and (Test-Path $_)) {
              Add-Content -Path $env:GITHUB_PATH -Value $_
            }
          }

      - name: OPAM available?
        run: opam --version

      - name: OPAM pin test
        run: opam pin add flow_parser https://github.com/rescript-lang/flow.git#d35a6f5c0cc219e85bbcb822d6f19ed9b2ec3448
